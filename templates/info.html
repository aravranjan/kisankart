{% extends "base.html" %}

{% block title %}KissanKart - Info & Updates{% endblock %}

{% block content %}
<link href="{{ url_for('static', filename='css/info.css') }}" rel="stylesheet">

<div class="bg-gradient-green">
    <div class="container-fluid py-5">
        <h2 class="text-center text-white mb-5">Information Hub ðŸ’¡</h2>
        <div class="row px-md-5">

            <!-- LEFT COLUMN: Weather -->
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm h-100 border-0 rounded-lg">
                    <div class="card-header bg-white font-weight-bold text-success">
                        Weather Assistant
                    </div>
                    <div class="card-body">
                        <div class="input-group mb-4">
                            <input type="text" id="cityInput" class="form-control"
                                placeholder="Enter city name (e.g. Nashik)" aria-label="City name">
                            <div class="input-group-append">
                                <button class="btn btn-success" type="button" id="getWeatherBtn">Get Forecast</button>
                            </div>
                        </div>

                        <div id="weatherResults" class="weather-container">
                            <div class="text-center text-muted py-5">
                                <i class="fas fa-cloud-sun fa-3x mb-3"></i>
                                <p>Search for a city to see the 5-day forecast</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN: News -->
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm h-100 border-0 rounded-lg">
                    <div class="card-header bg-white font-weight-bold text-success">
                        News & Updates
                    </div>
                    <div class="card-body">
                        <div class="border-dashed rounded p-3 text-muted mb-3 text-center">
                            Agriculture & market news will appear here
                        </div>
                        <div class="border-dashed rounded p-3 text-muted mb-3 text-center">
                            Government policies & alerts will appear here
                        </div>
                        <div class="border-dashed rounded p-3 text-muted text-center">
                            Weather warnings & price updates will appear here
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    document.getElementById('getWeatherBtn').addEventListener('click', function () {
        const city = document.getElementById('cityInput').value.trim();
        if (!city) return;

        const resultsDiv = document.getElementById('weatherResults');
        resultsDiv.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-success" role="status"></div></div>';

        fetch(`/api/weather?city=${encodeURIComponent(city)}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    resultsDiv.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                    return;
                }

                let html = `<h5 class="mb-3 text-success">5-Day Forecast for ${data.city}</h5>`;
                data.forecast.forEach(day => {
                    html += `
                    <div class="forecast-item d-flex align-items-center mb-2 p-2 border-bottom bg-light rounded shadow-sm">
                        <img src="https://openweathermap.org/img/wn/${day.icon}.png" alt="${day.desc}">
                        <div class="flex-grow-1 ml-2">
                            <div class="font-weight-bold" style="font-size: 0.9rem;">${new Date(day.date).toLocaleDateString('en-GB', { weekday: 'short', day: 'numeric', month: 'short' })}</div>
                            <small class="text-muted">${day.desc}</small>
                        </div>
                        <div class="text-right">
                            <span class="text-danger font-weight-bold">${day.max}Â°</span>
                            <span class="text-secondary ml-1">${day.min}Â°</span>
                        </div>
                    </div>
                `;
                });
                resultsDiv.innerHTML = html;
            })
            .catch(err => {
                resultsDiv.innerHTML = `<div class="alert alert-danger">Failed to fetch weather. Try again later.</div>`;
            });
    });

    document.getElementById('cityInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            document.getElementById('getWeatherBtn').click();
        }
    });
</script>
{% endblock %}